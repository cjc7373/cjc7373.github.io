<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Networking on Coherence's Blog</title><link>https://blog.coherence.codes/tags/networking/</link><description>Recent content in Networking on Coherence's Blog</description><generator>Hugo</generator><language>zh-cn</language><copyright>Coherence. 本站遵循 CC BY-NC-SA 4.0 协议</copyright><lastBuildDate>Sun, 24 Nov 2024 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.coherence.codes/tags/networking/index.xml" rel="self" type="application/rss+xml"/><item><title>OpenWrt 搭建透明代理</title><link>https://blog.coherence.codes/posts/2024/openwrt_transparent_proxy/</link><pubDate>Sun, 24 Nov 2024 00:00:00 +0000</pubDate><guid>https://blog.coherence.codes/posts/2024/openwrt_transparent_proxy/</guid><description>&lt;p>openclash、shellclash 之类的方案感觉都太复杂了。我的需求只是给 chromecast 用上代理，并且在代理失效时不要影响局域网中的其他设备。所以想找一个简单的方案。&lt;/p>
&lt;p>经过一番摸索，发现 Macvlan 很适合我，具体步骤如下：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>创建一个 macvlan 设备&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-openwrt" data-lang="openwrt">config device
 option type &amp;#39;macvlan&amp;#39;
 option ifname &amp;#39;br-lan&amp;#39;
 option mode &amp;#39;bridge&amp;#39;
 option name &amp;#39;br-lanmac0&amp;#39;
 option ipv6 &amp;#39;1&amp;#39;
&lt;/code>&lt;/pre>&lt;p>注意这里需要选择启用 ipv6，否则 br-lan 不会下发 RA，导致局域网内设备没有 v6 地址，具体原因还不清楚。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>创建一个接口绑定到这个设备&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-openwrt" data-lang="openwrt">config interface &amp;#39;clash&amp;#39;
 option proto &amp;#39;static&amp;#39;
 option device &amp;#39;br-lanmac0&amp;#39;
 option ipaddr &amp;#39;192.168.2.2&amp;#39;
 option netmask &amp;#39;255.255.255.0&amp;#39;
 option gateway &amp;#39;192.168.2.1&amp;#39;
 option defaultroute &amp;#39;0&amp;#39;
&lt;/code>&lt;/pre>&lt;p>IP 地址分配一个在局域网段下的，网关填 lan 地址。注意关闭默认路由，否则会把 PPPoE 的路由给删了，导致局域网内设备连不上网，具体原因也不清楚。这个接口不需要任何路由规则。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>把这个接口添加到防火墙的 lan zone 中，否则 lan 发给该接口的包会被丢弃&lt;/p>
&lt;/li>
&lt;li>
&lt;p>下载 mihomo （原 clash-meta）二进制，配置 tun 绑定到之前的设备上&lt;/p></description></item></channel></rss>