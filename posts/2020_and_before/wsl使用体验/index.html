<!doctype html><html><head><title>WSL使用体验</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content="3MbbliKSwhNvv713tGB2RL8xvrJC404x1BFONabsw7g"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/scss/journal.min.0f46f98b723f2aad4b02d9370bb6aa7848b5c2b2a5579642014082283683d2d8.css integrity="sha256-D0b5i3I/Kq1LAtk3C7aqeEi1wrKlV5ZCAUCCKDaD0tg=" media=screen><link rel=stylesheet href=/scss/dark-mode.min.79c34391dbcff20df8b4dac718e2606701efcbfdb9f3b08447ac39ac9dc7b463.css integrity="sha256-ecNDkdvP8g34tNrHGOJgZwHvy/2587CER6w5rJ3HtGM=" media=screen><script src=/js/toc.js></script>
<link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Material+Icons"><script async defer data-domain=blog.coherence.codes src=https://analytics.coherence.space/js/plausible.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script></head><body><div id=app><div id=sideContainer class=side-container><a class="a-block nav-head false" href=https://blog.coherence.codes/><div class=nav-title>Coherence's Blog</div></a><div class=nav-link-list><a class="a-block nav-link-item active" href=/posts>存档</a>
<a class="a-block nav-link-item false" href=/tags>标签</a>
<a class="a-block nav-link-item false" href=/categories>分类</a>
<a class="a-block nav-link-item false" href=/index.xml>RSS Feed</a></div><div class=nav-footer><a href=https://github.com/cjc7373/hugo-theme-diary>Modified</a> Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>移植自 <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
2022 Coherence's Blog</div></div><div id=extraContainer class=extra-container><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"><div class=toc-content><center>- 目录 -</center><ul><ul><li><a href=#%e5%bc%80%e5%90%afwsl onclick="onNavClick(`#开启wsl-nav`)" id=开启wsl-nav>开启WSL</a></li><li><a href=#arch onclick="onNavClick(`#arch-nav`)" id=arch-nav>Arch</a></li><li><a href=#%e4%bd%93%e9%aa%8c onclick="onNavClick(`#体验-nav`)" id=体验-nav>体验</a></li><ul><li><a href=#%e5%9d%91 onclick="onNavClick(`#坑-nav`)" id=坑-nav>坑</a></li><li><a href=#netcat onclick="onNavClick(`#netcat-nav`)" id=netcat-nav>Netcat</a></li><li><a href=#%e7%bc%ba%e7%82%b9 onclick="onNavClick(`#缺点-nav`)" id=缺点-nav>缺点</a></li></ul><li><a href=#windows-terminal onclick="onNavClick(`#windows-terminal-nav`)" id=windows-terminal-nav>Windows Terminal</a></li><ul><li><a href=#bug onclick="onNavClick(`#bug-nav`)" id=bug-nav>Bug</a></li></ul><li><a href=#wsl2 onclick="onNavClick(`#wsl2-nav`)" id=wsl2-nav>WSL2</a></li><ul><li><a href=#docker onclick="onNavClick(`#docker-nav`)" id=docker-nav>Docker</a></li><li><a href=#%e5%9d%91-1 onclick="onNavClick(`#坑-1-nav`)" id=坑-1-nav>坑</a></li></ul><li><a href=#pycharm onclick="onNavClick(`#pycharm-nav`)" id=pycharm-nav>Pycharm</a></li><ul><li><a href=#bug-1 onclick="onNavClick(`#bug-1-nav`)" id=bug-1-nav>Bug</a></li></ul><li><a href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 onclick="onNavClick(`#参考资料-nav`)" id=参考资料-nav>参考资料</a></li></ul></div></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up</i></a>
<a type=button class=pagination-action id=darkModeToggleButton><span class="material-icons pagination-action-icon" id=darkModeToggleIcon>dark_mode</span></a></div></div><div class=single-column-drawer-container id=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item active" href=/posts>存档</a>
<a class="a-block drawer-menu-item false" href=/tags>标签</a>
<a class="a-block drawer-menu-item false" href=/categories>分类</a>
<a class="a-block drawer-menu-item false" href=/index.xml>RSS Feed</a><div class=toc><div class=toc-content><center>- 目录 -</center><ul><ul><li><a href=#%e5%bc%80%e5%90%afwsl onclick="onNavClick(`#开启wsl-nav`)" id=开启wsl-nav>开启WSL</a></li><li><a href=#arch onclick="onNavClick(`#arch-nav`)" id=arch-nav>Arch</a></li><li><a href=#%e4%bd%93%e9%aa%8c onclick="onNavClick(`#体验-nav`)" id=体验-nav>体验</a></li><ul><li><a href=#%e5%9d%91 onclick="onNavClick(`#坑-nav`)" id=坑-nav>坑</a></li><li><a href=#netcat onclick="onNavClick(`#netcat-nav`)" id=netcat-nav>Netcat</a></li><li><a href=#%e7%bc%ba%e7%82%b9 onclick="onNavClick(`#缺点-nav`)" id=缺点-nav>缺点</a></li></ul><li><a href=#windows-terminal onclick="onNavClick(`#windows-terminal-nav`)" id=windows-terminal-nav>Windows Terminal</a></li><ul><li><a href=#bug onclick="onNavClick(`#bug-nav`)" id=bug-nav>Bug</a></li></ul><li><a href=#wsl2 onclick="onNavClick(`#wsl2-nav`)" id=wsl2-nav>WSL2</a></li><ul><li><a href=#docker onclick="onNavClick(`#docker-nav`)" id=docker-nav>Docker</a></li><li><a href=#%e5%9d%91-1 onclick="onNavClick(`#坑-1-nav`)" id=坑-1-nav>坑</a></li></ul><li><a href=#pycharm onclick="onNavClick(`#pycharm-nav`)" id=pycharm-nav>Pycharm</a></li><ul><li><a href=#bug-1 onclick="onNavClick(`#bug-1-nav`)" id=bug-1-nav>Bug</a></li></ul><li><a href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 onclick="onNavClick(`#参考资料-nav`)" id=参考资料-nav>参考资料</a></li></ul></div></div></div></div></div><transition name=fade><div id=drawer-mask v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav id=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div id=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu</i></button>
<a id=navTitle class=navbar-brand href=https://blog.coherence.codes/>Coherence's Blog</a>
<button type=button class=nav-darkmode-toggle id=darkModeToggleButton2>
<i class=material-icons id=darkModeToggleIcon2>dark_mode</i></button></div></nav><div class=single-column-header-container id=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://blog.coherence.codes/><div class=single-column-header-title>Coherence's Blog</div></a></div><div id=content><div id=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only><div class=post-title>WSL使用体验<div class=post-meta><time itemprop=datePublished>2019-12-08 19:12</time></div></div></div><div class=post-body-wrapper><div class=post-body v-pre><p>首先，WSL真香！</p><h2 id=开启wsl>开启WSL</h2><p>最简单的方式是使用管理员权限运行Powershell，然后输入：</p><p><code>Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux</code></p><p>重启电脑，然后在应用商店中安装WSL发行版。</p><h2 id=arch>Arch</h2><p>注意到WSL是没有Arch Linux发行版的（以前有一个非官方的，很快被下架了），但是我们有办法添加Arch发行版。去<a href=https://github.com/yuk7/ArchWSL>这个仓库</a>下载打包好的appx文件和证书，首先将证书导入至受信任的根证书颁发机构，然后安装appx即可。</p><h2 id=体验>体验</h2><h3 id=坑>坑</h3><ul><li><p>默认WSL不会读取<code>~/.bashrc</code>而会读取<code>~/.bash_profile</code>，所以需要在<code>~/.bash_profile</code>中写入：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -f ~/.bashrc <span style=color:#f92672>]]</span> ; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>	. ~/.bashrc
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>才能够正常读取bash配置。</p></li></ul><h3 id=netcat>Netcat</h3><p>首先我Google到的是<code>gnu-netcat</code>。但是运行时报错<code>nc: core.c:372: core_tcp_connect: Assertion ret == 0' failed.</code>搜索了<a href=https://github.com/msys2/MSYS2-packages/issues/1030>相关Issus</a>之后，我更换成了<a href=https://www.archlinux.org/packages/community/x86_64/openbsd-netcat/>openbsd-netcat</a>，问题解决。</p><h3 id=缺点>缺点</h3><ul><li>WSL下无法使用Docker等涉及内核的操作，该缺陷在WSL2中被解决。</li><li>默认无图形界面，使用GUI需自己安装X Server，较为麻烦。</li></ul><h2 id=windows-terminal>Windows Terminal</h2><p>注意，截至目前，Windows Terminal仍处于预览阶段，正式发布预计要到2020年4月。</p><p><img src=./image-20191115231943950.png alt=image-20191115231943950></p><p>安装WSL后，Windows Terminal能够自动识别WSL并添加至可用Terminal列表中。</p><h3 id=bug>Bug</h3><ul><li>启动Shell后的工作目录为Windows当前用户的Home目录，而非Linux的用户Home目录。</li></ul><p><img src=./image-20191115232130240.png alt=image-20191115232130240></p><p>​ 可以通过在配置文件中加入<code>"commandline" : "wsl ~"</code>来解决，不过这个方案只适用于默认WSL发行版，对于其他发行版无效，可以通过在<code>.bashrc</code>中添加一条判断语句来解决。</p><ul><li><p>Windows Terminal目前暂无法自动添加至右键菜单上下文，需手动添加注册表。</p></li><li><p>往Terminal中粘贴内容是会自动在行间加空格。（更新：这个bug是由于\r\n与\n的处理问题，在0.7中被解决）</p><p><img src=./image-20191115233340872.png alt=image-20191115233340872></p></li></ul><h2 id=wsl2>WSL2</h2><h3 id=docker>Docker</h3><p>可喜可贺，WSL终于能用Docker了。</p><p>配置镜像源（无systemd）：</p><blockquote><p>在配置文件 <code>/etc/default/docker</code> 中的 <code>DOCKER_OPTS</code> 中配置Hub地址：</p><pre tabindex=0><code>DOCKER_OPTS=&#34;--registry-mirror=https://docker.mirrors.ustc.edu.cn/&#34;
</code></pre><p>重新启动服务:</p><pre tabindex=0><code>sudo service docker restart
</code></pre></blockquote><h3 id=坑-1>坑</h3><ul><li><p>官方宣称在18945之后的版本中Windows访问WSL提供的网络服务只需使用localhost即可（服务需绑定之0.0.0.0而不是127.0.0.1，因为实际上这些连接被认为是局域网中的连接）。</p><p>尝试在Docker中使用。</p><p><img src=./image-20191116233838273.png alt=image-20191116233838273></p><p>使用<code>netstat -ano</code>如下：</p><p><img src=./image-20191116233912110.png alt=image-20191116233912110></p><p>然而在Windows下只能使用IPv6地址访问：</p><p><img src=./image-20191116233953189.png alt=image-20191116233953189>b</p><p>而不能使用IPv4：</p><p><img src=./image-20191116234023402.png alt=image-20191116234023402></p></li><li><p>无法使用systemd。</p></li></ul><h2 id=pycharm>Pycharm</h2><p>Pycharm能够将Python解释器设置为WSL中的Python。</p><p><img src=./image-20191119150317595.png alt=image-20191119150317595></p><p>同时能够将terminal设置为WSL：</p><p><img src=./image-20191119150135830.png alt=image-20191119150135830></p><p>只需要将Shell path设置成<code>bash.exe</code>即可。注意设置为<code>arch.exe</code>等自定义的发行版名称时，无法将当前工作目录传递给Shell。</p><p>注意到由于WSL没有图形界面，无法在Python中运行GUI程序。</p><h3 id=bug-1>Bug</h3><p><del>在WSL中安装的包无法被识别：</del></p><p><img src=./image-20191119150405724.png alt=image-20191119150405724></p><p><del>因此也无法使用这个包的自动补全、查看定义等一系列功能。</del></p><p><a href=https://www.jetbrains.com/help/pycharm/using-wsl-as-a-remote-interpreter.html>文档里</a>写得清清楚楚：</p><p><img src=./image-20191208194351006.png alt=image-20191208194351006></p><p>我错了，我应该看文档的。安装rsync之后问题解决。</p><h2 id=参考资料>参考资料</h2><hr width=100% id=EOF><p style=color:#777>最后修改于 2019-12-08</p></div></div><nav class=post-pagination><a class=newer-posts href=/posts/2020_and_before/2019summary_2020plan/>下回<br>2019年终总结&2020展望</a>
<a class=older-posts href=/posts/2020_and_before/reinstall-hexo/>上回<br>重新安装 Hexo</a></nav><div class=post-comment-wrapper></div></div></div></div></div><div id=single-column-footer><a href=https://github.com/cjc7373/hugo-theme-diary>Modified</a> Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>移植自 <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
2022 Coherence's Blog</div></div><script src=/js/journal.js></script></body></html>